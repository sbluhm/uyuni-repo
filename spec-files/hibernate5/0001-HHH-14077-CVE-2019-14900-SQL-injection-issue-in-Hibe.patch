From 70ae87fa85a55de247aea5343b33243b63fea542 Mon Sep 17 00:00:00 2001
From: Silvio Moioli <moio@suse.com>
Date: Wed, 12 Aug 2020 16:23:34 +0200
Subject: [PATCH] HHH-14077 : CVE-2019-14900 SQL injection issue in Hibernate

---
 .../internal/expression/LiteralExpression.java       | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

diff --git a/src/hibernate-orm-5.3.7/hibernate-core/src/main/java/org/hibernate/query/criteria/internal/expression/LiteralExpression.java b/src/hibernate-orm-5.3.7/hibernate-core/src/main/java/org/hibernate/query/criteria/internal/expression/LiteralExpression.java
index af42b2f0..fa66140b 100644
--- a/src/hibernate-orm-5.3.7/hibernate-core/src/main/java/org/hibernate/query/criteria/internal/expression/LiteralExpression.java
+++ b/src/hibernate-orm-5.3.7/hibernate-core/src/main/java/org/hibernate/query/criteria/internal/expression/LiteralExpression.java
@@ -78,15 +78,15 @@ public class LiteralExpression<T> extends ExpressionImpl<T> implements Serializa
 
 	@SuppressWarnings({ "unchecked" })
 	public String renderProjection(RenderingContext renderingContext) {
+		if ( ValueHandlerFactory.isCharacter( literal ) ) {
+			// In case literal is a Character, pass literal.toString() as the argument.
+			return renderingContext.getDialect().inlineLiteral( literal.toString() );
+		}
+
 		// some drivers/servers do not like parameters in the select clause
 		final ValueHandlerFactory.ValueHandler handler =
 				ValueHandlerFactory.determineAppropriateHandler( literal.getClass() );
-		if ( ValueHandlerFactory.isCharacter( literal ) ) {
-			return '\'' + handler.render( literal ) + '\'';
-		}
-		else {
-			return handler.render( literal );
-		}
+		return handler.render( literal );
 	}
 
 	@Override
-- 
2.26.2

